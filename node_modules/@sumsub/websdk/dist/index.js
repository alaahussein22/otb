!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).snsWebSdk=t()}(this,(function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)},t=function(){function t(e,t,i,n){var o=this;this.iframe=null,this.iframeId=null,this.sessionId="",this.$container=null,this.onMessage=function(e){o.onSdkMessage(e)},this.baseUrl=e,this.config=t,this.callbacks=i,this.options=n}return t.prototype.getIframeId=function(){if(2===this.config.version)try{return btoa(this.config.accessToken)}catch(e){return this.config.accessToken}return String(Math.floor(1e8*Math.random()))},t.prototype.launch=function(e){this.options.addViewportTag&&this.addViewportTag(),this.iframe=this.createIframe(e),this.sessionId="",this.iframeId="id_"+this.getIframeId(),this.iframe&&this.config?(this.registerEventListener(),this.iframe.src=this.getIframeSrc()):console.error("Idensic was not initialized since either provided element was not found in the DOM or invalid config")},t.prototype.addViewportTag=function(){var e=document.getElementsByName("viewport");if(!e||0===e.length){var t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","width=device-width,user-scalable=yes"),document.head.appendChild(t)}},t.prototype.createIframe=function(e){var t="string"==typeof e?document.querySelector(e):e;if(!t)return console.error("Provide a valid selector for the iframe container"),null;this.$container=t;var i=document.createElement("iframe");for(i.width="100%",i.scrolling="no",i.allow="camera; microphone; geolocation",i.setAttribute("frameborder","0");t.firstChild;)t.removeChild(t.firstChild);return t.appendChild(i),i},t.prototype.getIframeSrc=function(){var e="?_="+this.iframeId,t=2===this.config.version?"/websdk":"/idensic",i=this.baseUrl.indexOf("localhost")>-1?"":t,n=this.baseUrl+i+"/websdk.html";return 2===this.config.version&&this.config.theme&&(e+="&theme="+this.config.theme),n+e},t.prototype.registerEventListener=function(){window.addEventListener("message",this.onMessage)},t.prototype.onSdkMessage=function(t){var i;if(this.baseUrl===t.origin){var n=t.data;if(n.method&&~n.method.indexOf("idCheck")&&(!this.sessionId||this.sessionId===n.sessionId)&&(null===(i=this.iframe)||void 0===i?void 0:i.contentWindow)){"idCheck.onReady"==n.method&&n.frameId===this.iframeId&&(this.sessionId=n.sessionId,this.iframe.contentWindow.postMessage(e({method:"idCheck.init"},this.config),"*")),"idCheck.onResize"==n.method&&this.options.adaptIframeHeight&&(this.iframe.style.height=n.height+"px");var o=n.method;delete n.method,delete n.frameId,delete n.sessionId,"idCheck.onError"===o&&"invalid-token"===n.code?this.callExpirationHandler():"idCheck.onError"===o&&"function"==typeof this.callbacks.onError?this.callbacks.onError(n):"function"==typeof this.callbacks.onMessage&&this.callbacks.onMessage(o,n)}}},t.prototype.callExpirationHandler=function(){var e=this,t=this.callbacks.expirationHandler;t.legacy?t.handler((function(t){return e.updateAccessToken(t)})):t.handler().then((function(t){return e.updateAccessToken(t)}),(function(t){null!=t||(t="Failed to update access token"),t.message&&(t=t.message),"string"!=typeof t&&(t=String(t)),e.updateAccessToken(null,t)}))},t.prototype.updateAccessToken=function(e,t){var i,n;null===(n=null===(i=this.iframe)||void 0===i?void 0:i.contentWindow)||void 0===n||n.postMessage({method:"idCheck.updateAccessToken",accessToken:e,error:t},"*")},t.prototype.destroy=function(){for(window.removeEventListener("message",this.onMessage);this.$container&&this.$container.firstChild;)this.$container.removeChild(this.$container.firstChild);this.$container=null},t}(),i=function(){function e(e,t){if(this.baseUrl="https://api.sumsub.com",this.config=null,this.eventHandlers={},this.anyEventHandler=null,this.options={adaptIframeHeight:!0,addViewportTag:!0},"string"!=typeof e)throw new Error("Access token must be a string");if("function"!=typeof t)throw new Error("updateAccessToken callback is required");this.accessToken=e,this.updateAccessToken=t}return e.prototype.onTestEnv=function(){return this.baseUrl="https://test-api.sumsub.com",this},e.prototype.withBaseUrl=function(e){return this.baseUrl=e,this},e.prototype.withConf=function(e){return this.config=e,this},e.prototype.withOptions=function(e){return e.hasOwnProperty("adaptIframeHeight")&&(this.options.adaptIframeHeight=e.adaptIframeHeight),e.hasOwnProperty("addViewportTag")&&(this.options.addViewportTag=e.addViewportTag),this},e.prototype.on=function(e,t){return this.eventHandlers[e]=t,this},e.prototype.onMessage=function(e){return this.anyEventHandler=e,this},e.prototype.build=function(){var e,i,n,o,s,r,a,d,h,c,l=this;return new t(this.baseUrl,{version:null===(e=this.config)||void 0===e?void 0:e.version,theme:null===(i=this.config)||void 0===i?void 0:i.theme,accessToken:this.accessToken,lang:null===(n=this.config)||void 0===n?void 0:n.lang,email:null===(o=this.config)||void 0===o?void 0:o.email,phone:null===(s=this.config)||void 0===s?void 0:s.phone,country:null===(r=this.config)||void 0===r?void 0:r.country,uiConf:null===(a=this.config)||void 0===a?void 0:a.uiConf,i18n:null===(d=this.config)||void 0===d?void 0:d.i18n,documentsByCountries:null===(h=this.config)||void 0===h?void 0:h.documentsByCountries,documentDefinitions:null===(c=this.config)||void 0===c?void 0:c.documentDefinitions},{expirationHandler:{legacy:!1,handler:this.updateAccessToken},onMessage:function(e,t){var i;l.eventHandlers[e]?l.eventHandlers[e](t):null===(i=l.anyEventHandler)||void 0===i||i.call(l,e,t)}},this.options)},e}(),n=function(){function e(e,t){this.debugEnabled=!1,this.options={adaptIframeHeight:!0,addViewportTag:!0},this.config=null,this.accessToken=null,this.expirationHandler=null,this.baseUrl=e,this.flowName=t}return e.prototype.withAccessToken=function(e,t){if(this.accessToken=e,!t||"function"!=typeof t)throw new Error('Invalid parameter, "expirationHandler" must be a function');return this.expirationHandler=t,this},e.prototype.debug=function(e){return this.debugEnabled=e,this},e.prototype.withOptions=function(e){return e.hasOwnProperty("adaptIframeHeight")&&(this.options.adaptIframeHeight=e.adaptIframeHeight),e.hasOwnProperty("addViewportTag")&&(this.options.addViewportTag=e.addViewportTag),this},e.prototype.withConf=function(e){return this.config=e,this},e.prototype.build=function(){var e,i,n,o,s,r,a,d,h,c,l,u;if(!this.accessToken||!this.expirationHandler)throw new Error("Configure access token end the expiration handler before");return new t(this.baseUrl,{version:null===(e=this.config)||void 0===e?void 0:e.version,theme:null===(i=this.config)||void 0===i?void 0:i.theme,accessToken:this.accessToken,flowName:this.flowName,lang:null===(n=this.config)||void 0===n?void 0:n.lang,email:null===(o=this.config)||void 0===o?void 0:o.email,phone:null===(s=this.config)||void 0===s?void 0:s.phone,country:null===(r=this.config)||void 0===r?void 0:r.country,uiConf:null===(a=this.config)||void 0===a?void 0:a.uiConf,i18n:null===(d=this.config)||void 0===d?void 0:d.i18n,documentsByCountries:null===(h=this.config)||void 0===h?void 0:h.documentsByCountries,documentDefinitions:null===(c=this.config)||void 0===c?void 0:c.documentDefinitions},{expirationHandler:{legacy:!0,handler:this.expirationHandler},onMessage:null===(l=this.config)||void 0===l?void 0:l.onMessage,onError:null===(u=this.config)||void 0===u?void 0:u.onError},{adaptIframeHeight:this.options.adaptIframeHeight,addViewportTag:this.options.addViewportTag,debug:this.debugEnabled})},e}();return{Builder:function(e,t){return new n(e,t)},init:function(e,t){return new i(e,t)}}}));
